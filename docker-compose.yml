version: "3.8"

services:
  mc-ledger-stats:
    image: mc-ledger-stats:latest
    ports:
      - "${PORT:-5000}:${PORT:-5000}"
    environment:
      - LEDGER_DB=/app/ledger.sqlite
      - STATS_LIMIT=${STATS_LIMIT:-10}
      - STATS_CACHE_TTL=${STATS_CACHE_TTL:-1800}
      - PORT=${PORT:-5000}
    volumes:
      - "${LEDGER_DB_PATH:-./ledger.sqlite}:/app/ledger.sqlite:ro"
    deploy:
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 30s
