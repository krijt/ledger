version: "3.8"

services:
  mc-ledger-stats:
    image: mc-ledger-stats:latest
    ports:
      - "${PORT:-5000}:${PORT:-5000}"
    environment:
      - LEDGER_DB=/app/ledger.sqlite
      - LEDGER_DB_PATH=${LEDGER_DB_PATH:?Set LEDGER_DB_PATH to absolute ledger.sqlite path}
      - STATS_LIMIT=${STATS_LIMIT:-10}
      - STATS_CACHE_TTL=${STATS_CACHE_TTL:-1800}
      - PORT=${PORT:-5000}
    volumes:
      - type: bind
        source: ${LEDGER_DB_PATH:?Set LEDGER_DB_PATH to absolute ledger.sqlite path}
        target: /app/ledger.sqlite
        read_only: true
    deploy:
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 30s
